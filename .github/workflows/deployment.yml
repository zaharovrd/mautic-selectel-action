name: Deploy Client Mautic

on:
  workflow_dispatch:
    inputs:
      vps_name:
        description: '–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, client-name-mautic)'
        required: true
      email:
        description: 'Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è Mautic'
        required: true
      domain:
        description: '–î–æ–º–µ–Ω –¥–ª—è Mautic (–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è IP-–∞–¥—Ä–µ—Å–∞)'
        required: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Deploy Mautic to Selectel
        id: deploy
        uses: ./
        with:
          # --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Selectel ---
          selectel-token: ${{ secrets.SELECTEL_TOKEN }}
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
          vps-name: ${{ github.event.inputs.vps_name }}
          vps-rplan: 'medium'
          vps-location: 'spb0'

          # --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Mautic (–∏–∑ workflow inputs) ---
          email: ${{ github.event.inputs.email }}
          domain: ${{ github.event.inputs.domain }}

          # --- –ü–∞—Ä–æ–ª–∏ –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ ---
          mautic-password: ${{ secrets.MAUTIC_PASSWORD_DEFAULT }} # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          mysql-password: ${{ secrets.MYSQL_PASSWORD_DEFAULT }}
          mysql-root-password: ${{ secrets.MYSQL_ROOT_PASSWORD_DEFAULT }}

      - name: Show deployment results
        run: |
          echo "üéâ Deployment completed!"
          echo "VPS IP: ${{ steps.deploy.outputs.vps-ip }}"
          echo "Mautic URL: ${{ steps.deploy.outputs.mautic-url }}"

      # --- –ù–û–í–´–ô –ë–õ–û–ö –û–ß–ò–°–¢–ö–ò (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ---
      # –≠—Ç–æ—Ç —à–∞–≥ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä —É–¥–∞–ª—è–ª—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞.
      # –î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É —ç—Ç–æ—Ç —à–∞–≥ –ù–£–ñ–ù–û –£–î–ê–õ–ò–¢–¨.
      # - name: Cleanup Server
      #   if: always() # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞
      #   run: |
      #     echo "üßπ Cleaning up server..."
      #     # –ó–¥–µ—Å—å –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ Selectel —á–µ—Ä–µ–∑ curl, –µ—Å–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω
