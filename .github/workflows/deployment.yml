name: Deploy or Update Mautic to Selectel

on:
  workflow_dispatch:
    inputs:
      vps_name:
        description: '–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, client-name-mautic)'
        required: true
        default: 'mautic-production'
      email:
        description: 'Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è Mautic'
        required: true
        default: 'admin@example.com'
      domain:
        description: '–î–æ–º–µ–Ω –¥–ª—è Mautic (–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è IP-–∞–¥—Ä–µ—Å–∞)'
        required: false
      mautic_version:
        description: '–í–µ—Ä—Å–∏—è Docker-–æ–±—Ä–∞–∑–∞ Mautic'
        required: true
        default: '6.0.5-apache'
        
      plugins:
        description: '–°–ø–∏—Å–æ–∫ URL –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)'
        required: false
        type: string


jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Deploy Mautic to Selectel
        id: deploy
        uses: ./
        with:
          # --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Selectel ---
          selectel-token: ${{ secrets.SELECTEL_TOKEN }}
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
          vps-name: ${{ github.event.inputs.vps_name }}
          vps-rplan: 'medium'
          vps-location: 'spb0'

          # --- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Mautic (–∏–∑ workflow inputs) ---
          email: ${{ github.event.inputs.email }}
          domain: ${{ github.event.inputs.domain }}
          mautic-version: ${{ github.event.inputs.mautic_version }}

          # --- –ü–∞—Ä–æ–ª–∏ –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ ---
          mautic-password: ${{ secrets.MAUTIC_PASSWORD }}
          mysql-password: ${{ secrets.MYSQL_PASSWORD }}
          mysql-root-password: ${{ secrets.MYSQL_ROOT_PASSWORD }}
          # --- –ü–ª–∞–≥–∏–Ω—ã ---
          plugins: ${{ github.event.inputs.plugins }} 

      - name: Show deployment results
        run: |
          echo "üéâ Deployment/Update completed!"
          echo "VPS IP: ${{ steps.deploy.outputs.vps-ip }}"
          echo "Mautic URL: ${{ steps.deploy.outputs.mautic-url }}"
